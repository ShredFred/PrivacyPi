<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="PrivacyPi : A tutorial for creating an Internet data retention privacy solution using Raspberry Pi running Raspian, OpenVPN, Privoxy, and Dante.">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>PrivacyPi</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/jonathanhaslett/PrivacyPi">View on GitHub</a>

          <h1 id="project_title">PrivacyPi</h1>
          <h2 id="project_tagline">A tutorial for creating an Internet data retention privacy solution using Raspberry Pi running Raspian, OpenVPN, Privoxy, and Dante.</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/jonathanhaslett/PrivacyPi/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/jonathanhaslett/PrivacyPi/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a id="privacypi" class="anchor" href="#privacypi" aria-hidden="true"><span class="octicon octicon-link"></span></a>PrivacyPi</h1>

<p>Inspired by Gavin's work at <a href="http://www.privacypi.org/">http://www.privacypi.org/</a> I've created this tutorial to make it as easy for anyone with basic computer skills to buy an off-the-shelf parts and make a device that increases the cost of government invasion of privacy from tens of dollars to tens of thousands of dollars.</p>

<p>Please submit issues or pull requests at <a href="https://github.com/jonathanhaslett/PrivacyPi">https://github.com/jonathanhaslett/PrivacyPi</a>.</p>

<h2>
<a id="getting-started-with-the-raspberry-pi-and-raspbian" class="anchor" href="#getting-started-with-the-raspberry-pi-and-raspbian" aria-hidden="true"><span class="octicon octicon-link"></span></a>Getting started with the Raspberry Pi and Raspbian</h2>

<h3>
<a id="requirements" class="anchor" href="#requirements" aria-hidden="true"><span class="octicon octicon-link"></span></a>Requirements:</h3>

<p>A Raspberry Pi kit including:</p>

<ul>
<li>Raspberry Pi. I used a <a href="https://www.raspberrypi.org/products/raspberry-pi-2-model-b/">Raspberry Pi 2 Model B</a>
</li>
<li>8GB MicroSD memory card</li>
<li>Micro USB cable</li>
<li>USB charger capable of <a href="https://google.com/">powering the Pi</a>
</li>
<li>Ethernet cable</li>
<li>A housing to keep your Pi safe and secure after installation. I went with <a href="https://google.com/">this</a>.</li>
</ul>

<p>Along with these extras for getting set up:</p>

<ul>
<li>Monitor with HDMI input</li>
<li>HDMI cable</li>
<li>USB keyboard</li>
<li>USB mouse</li>
</ul>

<h3>
<a id="install-raspbian-using-noobs" class="anchor" href="#install-raspbian-using-noobs" aria-hidden="true"><span class="octicon octicon-link"></span></a>Install Raspbian using NOOBS</h3>

<p>NOOBS stands for <strong>New Out Of the Box Software</strong> and is the installer and recovery platform that we'll use to install Raspbian on our Pi.</p>

<p>Follow the <a href="https://www.raspberrypi.org/help/noobs-setup/">NOOBS Setup Guide</a> and you'll end up on the desktop of a fresh installation of Raspbian and ready to continue building your PrivacyPi.</p>

<h3>
<a id="change-some-settings" class="anchor" href="#change-some-settings" aria-hidden="true"><span class="octicon octicon-link"></span></a>Change some settings</h3>

<p>Once you're on the Raspbian desktop head over to the settings and update these settings:</p>

<ul>
<li>Change your devices name to PrivacyPi</li>
<li>Change your password to something other than the default <code>raspberry</code>
</li>
<li>Update your date, time, and location</li>
<li>Set your language and keyboard layout</li>
<li>Set the Pi to automatically login with the <code>pi</code> user on startup</li>
<li>Set your Pi to start in the command line interface (CLI), this will free up resources when you no longer need the desktop. The command to manually load the desktop whenever you need to is <code>startx</code>
</li>
</ul>

<p>For some added local security you could go ahead and change the password for the <code>pi</code> user to something other than the default <code>raspberry</code>. This could be helpful if you regularly have people poking around on your local network.</p>

<h3>
<a id="configure-your-local-network" class="anchor" href="#configure-your-local-network" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configure your local network</h3>

<p>It's important that your Pi is always assigned the same IP address by your router (DHCP Server). The good news is that most routers these days make it easy for you to manually reserve an IP address for your device. </p>

<p>Login to your router's management interface and reserver an IP address for your Pi that matches your existing network, usually this will look like <code>192.168.0.x</code> or <code>192.168.1.x</code>. Refer to your routers documentation for specific instructions but usually you'll need to find the table showing all the connected devices (DHCP Table) and choosing a device to reserve an address for. You'll recall we renamed the Pi to <code>PrivacyPi</code> so it should be easy to identify from the table.</p>

<p>For the rest of the tutorial we're going to assume you've assigned the IP address <code>192.168.1.251</code> to your Pi which has the hostname <code>PirvacyPi</code>.</p>

<p>Restart your Pi. It should load to the CLI. </p>

<p>Once at the CLI you can confirm that you've been assigned the correct IP address by typing the command:</p>

<pre><code>ifconfig -a
</code></pre>

<p>Hopefully you should see an output that starts with something like:</p>

<pre><code>eth0 Link encap:Ethernet  HWaddr XX:XX:XX:XX:XX:XX  
inet addr:192.168.1.251  Bcast:192.168.1.255  Mask:255.255.255.0
inet6 addr: fe80::ba27:ebff:fe54:bee5/64 Scope:Link
UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
RX packets:607649 errors:0 dropped:1097 overruns:0 frame:0
TX packets:492564 errors:0 dropped:0 overruns:0 carrier:0
collisions:0 txqueuelen:1000    
</code></pre>

<h2>
<a id="install-privacypi-bundle" class="anchor" href="#install-privacypi-bundle" aria-hidden="true"><span class="octicon octicon-link"></span></a>Install PrivacyPi Bundle</h2>

<p>This step could technically be completed using the Pi's CLI but for a lot of users it will be easier to load up the desktop by typing <code>startx</code>.</p>

<ol>
<li>Open the Pi's web browser and head to <a href="http://privacypi.io/">privacypi.io</a> and ownload the <a href="https://github.com/jonathanhaslett/PrivacyPi/zipball/master">latest PrivacyPie zip archive</a>.</li>
<li>Extract the files from the zip archive.</li>
<li>Opens the Pi's file manager program and move all the files you just extracted to your home directory, if you're still using the default "pi" user then you're home directory will be located at <code>/home/pi/</code>.</li>
<li>Open the Pi's terminal client. It should automatically place you in your home directory, shown as <code>~</code>. If you enter the command <code>ls</code> it should show a listing of the home directory folders along with the files you just moved during the previous step.</li>
<li>Run the PrivacyPi install script by typing the command <code>sh install</code>. The script will use <code>apt-get</code> to install the software needed and make a few changes so that you're ready to move on to the next steps below.</li>
</ol>

<h2>
<a id="openvpn---vpn-client" class="anchor" href="#openvpn---vpn-client" aria-hidden="true"><span class="octicon octicon-link"></span></a>OpenVPN - VPN Client</h2>

<p>Using the Pi's web browser, download the OpenVPN configuration files from your VPN provider's website. The file with either be a single <code>*.conf</code> file or an archive containing multiple files such as a <code>*.conf</code> files and some certificate files.</p>

<p>Edit the main .conf file with the Pi's text editor and add these two lines t the bottom of the file:</p>

<pre><code>script-security 2
up /home/pi/vpn-up
down /home/pi/vpn-down
</code></pre>

<p>These commands will automatically start and stop the proxy servers when the VPN starts or stops. This prevents a problem that Gavin <a href="http://www.privacypi.org/making-things-a-little-more-private/">described</a> where you'll run into problem if a proxy server tries to start using the VPN's <code>tun0</code> network interface before it exists.</p>

<p>The next step is to move the files but you'll need Super User privileges to write to <code>/etc/openvpn/</code> so close the file manager and then launch it from the terminal with SU privileges by typing <code>sudo pcmanfm</code>.</p>

<p>Move all the files provided by your VPN provider to the <code>/etc/openvpn/</code>` directory. When OpenVPN start's it will search this folder for a *.conf file and use those details to connect to your VPN.</p>

<h2>
<a id="how-to-start-openvpn-automatically-when-the-rpi-starts" class="anchor" href="#how-to-start-openvpn-automatically-when-the-rpi-starts" aria-hidden="true"><span class="octicon octicon-link"></span></a>How to start OpenVPN Automatically When the RPi Starts</h2>

<p>Now that the OpenVPN server is installed, it is time to make it run as a service every time the Pi boots up.</p>

<p>Edit the file <code>/etc/default/openvpn</code> with:</p>

<pre><code>sudo pico /etc/default/openvpn
</code></pre>

<p>Uncomment the line <code>#AUTOSTART="all"</code> and either leave it as all, or replace it with the name of the specific server <code>*.conf</code> file you'd like to automatically connect.</p>

<p>That's it, OpenVPN should be ready to go unless there's a problem with with your provided config. We'll get around to testing everything in a minute.</p>

<h2>
<a id="privoxy---httphttps-proxy" class="anchor" href="#privoxy---httphttps-proxy" aria-hidden="true"><span class="octicon octicon-link"></span></a>Privoxy - HTTP/HTTPS Proxy</h2>

<p><em>Privoxy is a non-caching web proxy with advanced filtering capabilities for enhancing privacy, modifying web page data and HTTP headers, controlling access, and removing ads and other obnoxious Internet junk.</em> - <a href="http://www.privoxy.org/">privoxy.org</a></p>

<p>Only minor changes are required for privoxy.</p>

<p>Open the config file by typing:</p>

<pre><code>sudo pico /etc/privoxy/config
</code></pre>

<p>Search for the variable named <code>listen-address</code> and change it's value to your Pi's IP address, for example I'm using <code>192.168.1.251</code>.</p>

<h2>
<a id="dante---socks5-proxy" class="anchor" href="#dante---socks5-proxy" aria-hidden="true"><span class="octicon octicon-link"></span></a>Dante - SOCKS5 Proxy</h2>

<p>Dante is a <a href="https://en.wikipedia.org/wiki/SOCKS">SOCKS proxy</a> that we'll use to route non-web traffic through the VPN connection. </p>

<p>The <code>sh install</code> script has done most the heavy lifting here. we've replaced Dante's config file that tells Dante to accept incoming connections on port <code>1080</code> and route traffic through the VPN connection labeled <code>tun0</code>.</p>

<p>If, in the future you want to make further config changes, you can view and edit the Dante config file by typing:</p>

<pre><code>sudo pico /etc/danted.conf
</code></pre>

<h2>
<a id="testing-your-new-software" class="anchor" href="#testing-your-new-software" aria-hidden="true"><span class="octicon octicon-link"></span></a>Testing your new software.</h2>

<p>If you extracted all the files to your <code>/home/pi</code> home directory you'll be able to type these commands to control the software we've just installed:</p>

<p><code>sh ~/start</code> - start OpenVPN, and thanks to your config file changes start Privoxy/Dante once the VPN is connected.</p>

<p><code>sh ~/stop</code> - stop OpenVPN, and thanks to your config file changes stop Privoxy/Dante as well.</p>

<p><code>sh ~/status</code> - output the status for the VPN connection (tun0) and well as the status of the services OpenVPN, Privoxy, and Dante.</p>

<p>When OpenVPN has connected and Privoxy+Dante have successfully started, the <code>sh ~/status</code> command should output something similar to this:</p>

<pre><code>tun0      Link encap:UNSPEC  HWaddr 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00  
      inet addr:XX.XXX.X.XX  P-t-P:XXX.XXX.X.XX  Mask:255.255.0.0
      inet6 addr: fdad:bdef:735d:72::101d/112 Scope:Global
      UP POINTOPOINT RUNNING NOARP MULTICAST  MTU:1500  Metric:1
      RX packets:856098 errors:0 dropped:0 overruns:0 frame:0
      TX packets:612917 errors:0 dropped:7655 overruns:0 carrier:0
      collisions:0 txqueuelen:100 
      RX bytes:1131753021 (1.0 GiB)  TX bytes:42825235 (40.8 MiB)

openvpn.service - OpenVPN service
    Loaded: loaded (/lib/systemd/system/openvpn.service; enabled)
    Active: active (exited) since Mon 2015-10-19 22:39:46 ACST; 1 weeks 0 days ago
    Process: 5771 ExecStart=/bin/true (code=exited, status=0/SUCCESS)
    Main PID: 5771 (code=exited, status=0/SUCCESS)
    CGroup: /system.slice/openvpn.service

privoxy.service - Privacy enhancing HTTP Proxy
    Loaded: loaded (/lib/systemd/system/privoxy.service; disabled)
    Active: active (running) since Mon 2015-10-19 22:40:00 ACST; 1 weeks 0 days ago
    Process: 5724 ExecStopPost=/bin/rm -f $PIDFILE (code=exited, status=0/SUCCESS)
    Process: 5910 ExecStart=/usr/sbin/privoxy --pidfile $PIDFILE --user $OWNER $CONFIGFILE (code=exited, status=0/SUCCESS)
    Main PID: 5911 (privoxy)
    CGroup: /system.slice/privoxy.service
       └─5911 /usr/sbin/privoxy --pidfile /var/run/privoxy.pid --user pri...

danted.service - LSB: SOCKS (v4 and v5) proxy daemon (danted)
    Loaded: loaded (/etc/init.d/danted)
    Active: active (running) since Mon 2015-10-19 22:39:59 ACST; 1 weeks 0 days ago
    Process: 5868 ExecStart=/etc/init.d/danted start (code=exited, status=0/SUCCESS)
    CGroup: /system.slice/danted.service
       ├─5874 /usr/sbin/danted -D
       ├─5875 /usr/sbin/danted -D
       ├─5876 /usr/sbin/danted -D
       ├─5877 /usr/sbin/danted -D
       ├─5878 /usr/sbin/danted -D
       ├─5879 /usr/sbin/danted -D
       └─5881 /usr/sbin/danted -D
</code></pre>

<p>If it looks like your VPN <code>tun0</code> is connected and Privoxy+Dante are running you should be ready to open up your PC's browser/torrent software and enter the proxy settings.</p>

<p>For a HTTP/HTTPS proxy you'll need to enter the Pi's IP Address plus port <code>8118</code>.</p>

<p>For a SOCKS5 proxy you'll need to enter the Pi's IP Address plus port <code>1080</code>.</p>

<p>After setting up the proxy in your web browser, test that it's working by visiting the website <a href="https://ipleak.net/">https://ipleak.net/</a> to confirm that your network traffic is being routed through the VPN.</p>

<p>If everything is up and running as expected it's time to reboot your Pi and disconnect the keyboard, mouse, and monitor. Wait a few minutes for the system to restart and then test your proxied web browser again.</p>

<p>From now on you'll be able to connect to the Pi over your network using a SSH with the <code>pi</code> username and with the default <code>raspberry</code> password or the password that you've set.</p>

<p>If you run into any problems or have suggestions for improvements, head over the GitHub repository at <a href="https://github.com/jonathanhaslett/PrivacyPi/issues">https://github.com/jonathanhaslett/PrivacyPi/issues</a>.</p>

<h2>
<a id="future-ideas" class="anchor" href="#future-ideas" aria-hidden="true"><span class="octicon octicon-link"></span></a>Future Ideas:</h2>

<ul>
<li>Install Script Upgrade

<ul>
<li>Uninstall software/services that aren't needed to free up more system resources</li>
<li>
</ul>
</li>
</ul>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">PrivacyPi maintained by <a href="https://github.com/jonathanhaslett">jonathanhaslett</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
